<script type="text/javascript" src="../common/js/zepto-mvalidate.js"></script>
<script type="text/javascript" src="../common/js/layer_mobile/layer.js"></script>
<div class="ct-dialog-box" id="J_ct-dialog-box">
    <div class="ct-dia-hd"></div>
    <div class="ct-dia-bd">
        <div class="dia-form">
            <form method="post" action="" id="J_forms">
                <div class="item">
                    <input type="text" placeholder="姓名" name="username" class="ipt-text" data-required="true" data-descriptions="username" />
                </div>
                <div class="item">
                    <input type="text" placeholder="联系方式" name="telphone" class="ipt-text" data-pattern="^0?1[3|4|5|7|8][0-9]\d{8}$" data-required="true" data-descriptions="phone" />
                </div>
                <input type="submit" class="ipt-submit" value="提交">
            </form>
            <p class="yq-tip">成功提交您的信息后，我们将有专人在最近一个 工作日联系您，请您保持手机畅通
            </p>
        </div>
    </div>
    <span class="close"></span>
    <span class="decorate"></span>
    <span class="line"></span>
</div>
<div class="ct-dialog-shadow" id="J_ct-dialog-shadow"></div>
<script type="text/javascript">
$(function() {
    var DialogObj = (function() {
        var $container = $("#J_ct-dialog-box"),
            $close =$container.find(".close"),
            $line=$container.find(".line"),
            $shadow = $("#J_ct-dialog-shadow");
        var pos = {};

        var initWH=function() {
                var selfW = $container.width();
                var selfH = $container.height();
                var winW = $(window).width();
                var winH = $(window).height();
                pos.top=(winH-selfH) > 0 ? (winH-selfH)/2 : 0;
                pos.left=(winW-selfW) > 0 ? (winW-selfW)/2 : 0;
                pos.nTop=-(selfH+pos.top+10);
                $container.css({left:pos.left,top:pos.nTop});
                $line.css({top:-pos.top,height:pos.top})
        }

        var ShadowHandle={
                show:function(){
                    $shadow.addClass('active');
                },
                hide:function(){
                    $shadow.removeClass('active');
                }
        };


        var MainHandle={
            show:function(callback){
               $container.animate({top:pos.top},400,"ease-out",function(){
                    !!callback && callback(); 
               }); 
            },
            hide:function(callback){
               $container.animate({top:pos.nTop},400,"ease-out",function(){
                    !!callback && callback(); 
               }) 

            }
        };


        $close.on("click",function(){
               
                ShadowHandle.hide();
                MainHandle.hide();
        });
        $shadow.on("click",function(){
                ShadowHandle.hide();
                MainHandle.hide();
        }).on("touchmove",function(event){
            event.stopPropagation();
            return false;
        });
        $(window).on("resize", initWH).trigger("resize");
        return {
            show:function(fn){
               
                ShadowHandle.show();
                MainHandle.show(fn);
            },
            hide:function(fn){
               
                ShadowHandle.hide();
                MainHandle.hide(fn);
            }
        } 
    })();


   //点击开桌那妞弹出框
    $("#J_btn-kz").on("click", function(event) {
        event.preventDefault();
        DialogObj.show();
    });

    $("#J_forms").mvalidate({
        type: 1,
        sendForm: false,
        firstInvalidFocus: false,
        descriptions: {
            username: {
                required: '请输入姓名！'
            },
            phone: {
                required: '请输入手机号码',
                pattern: '您输入的手机号码格式不正确'
            }
        },
        valid: function() {

            //开发请写这里,服务端请返回 true表示成功 返回false 表示失败
            $.ajax({
                url:"http://wnworld.com/conn/test.php",
                data: $("#J_orderform").serialize(),
                type: "post",
                beforeSend: function() {
                   layer.load(1,{
                            shade: [0.1, '#fff']
                        }) //0.1透明度的白色背景});
                },
                success: function(data) {
                    layer.close(layerLoadIndex);
                    if (!!data) {
                        $orderForm.hide();
                        $orderSuccess.show();
                    } else {
                        layer.msg('亲,路途太堵,请您重新提交！');
                    }
                }
            })
        }
    });

})
</script>
